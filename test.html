<!-- ğŸŒ¸ MedAÄ° Chat BaÅŸlangÄ±Ã§ -->
<div id="medai-widget"></div>

<script>
const medaiWidget = document.getElementById("medai-widget");

// kutunun html tasarÄ±mÄ±
medaiWidget.innerHTML = `
  <div style="
    background: linear-gradient(145deg, rgba(26,26,64,0.95), rgba(255,77,166,0.15));
    border: 1px solid rgba(255,77,166,0.4);
    border-radius: 22px;
    padding: 26px;
    color: #fff;
    font-family: 'Inter', sans-serif;
    width: 380px;
    max-width: 90%;
    margin: 60px auto;
    text-align: center;
    box-shadow: 0 0 40px rgba(255,77,166,0.25);
    backdrop-filter: blur(14px);
    transition: all 0.3s ease;
  ">
    <h3 style="font-size:22px;color:#ff4da6;margin-bottom:10px;">âœ¨ MedAÄ°</h3>
    <p style="font-size:15px;opacity:0.95;">
      Selam, ben <b>MedAÄ°</b> ğŸ’«<br>
      Ruhunu ve stilini birlikte dengeleyelim mi?
    </p>
    <textarea id="userMessage" placeholder="Bana yaz..." 
      style="margin-top:16px;width:100%;height:60px;border-radius:10px;
      padding:10px;border:none;resize:none;font-family:'Inter',sans-serif;"></textarea>
    <button id="sendMessage" 
      style="margin-top:12px;background:linear-gradient(90deg,#ff4da6,#ff9966);
      border:none;padding:12px 24px;color:white;font-weight:600;
      border-radius:10px;cursor:pointer;transition:transform 0.3s;">
      GÃ¶nder ğŸ’¬
    </button>
    <p id="limitInfo" style="font-size:12px;color:#ffd6eb;margin-top:10px;"></p>
    <div id="responseArea" 
      style="margin-top:18px;text-align:left;font-size:14px;
      color:#ffd6eb;line-height:1.6;max-height:240px;overflow-y:auto;"></div>
  </div>
`;

let messageCount = localStorage.getItem("medaiCount") || 0;
const limit = 10;
const limitInfo = document.getElementById("limitInfo");
const updateLimitText = () => {
  limitInfo.innerText = `Kalan mesaj hakkÄ±n: ${limit - messageCount}`;
};
updateLimitText();

document.getElementById("sendMessage").addEventListener("click", async () => {
  if (messageCount >= limit) {
    alert("âœ¨ GÃ¼nlÃ¼k mesaj limitine ulaÅŸtÄ±n aÅŸkÄ±m. YarÄ±n gÃ¶rÃ¼ÅŸÃ¼rÃ¼z ğŸ’«");
    return;
  }

  const userMessage = document.getElementById("userMessage").value;
  const responseDiv = document.getElementById("responseArea");
  if (!userMessage.trim()) return;

  responseDiv.innerHTML += `<p><b>Sen:</b> ${userMessage}</p>`;
  document.getElementById("userMessage").value = "";

  try {
    const response = await fetch("/api/chat", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ message: userMessage })
    });

    const data = await response.json();
    const reply = data.reply || "Bir ÅŸeyler ters gitti ğŸ’«";
    responseDiv.innerHTML += `<p><b>MedAÄ°:</b> ${reply}</p>`;
    responseDiv.scrollTop = responseDiv.scrollHeight;
    messageCount++;
    localStorage.setItem("medaiCount", messageCount);
    updateLimitText();
  } catch (error) {
    responseDiv.innerHTML += `<p><b>MedAÄ°:</b> BaÄŸlantÄ±da sorun oluÅŸtu ğŸ’«</p>`;
  }
});
</script>
<!-- ğŸŒ¸ MedAÄ° Chat BitiÅŸ -->
